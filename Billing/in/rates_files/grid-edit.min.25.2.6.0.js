let uniqueid;$(function(){var e;let r;const l=5678;let s=[],d=0!==localStorage.getItem("_cells_customer_role");const c=decodeURIComponent(v("FolderName")),p=decodeURIComponent(v("FileName")),u=decodeURIComponent(v("Password")),t=o.CallbackURL,m=o.APIBasePath,a=decodeURIComponent(v("Uid")),h=o.AppUrl,n="https://www.googleapis.com/auth/drive.file",i=o.GoogleDriveConfigurations.GoogleDriveClientId;let f,w=null,g=!1,y=!1;async function b(e){var t=e.receiver,e=e.type;const a=r.datas;delete a.history,delete a.search,delete a.images,delete a.shapes;e={p:{sheetname:r.sheet.data.name,actrow:r.sheet.data.selector.ri,actcol:r.sheet.data.selector.ci,datas:r.getUpdateDatas()},uid:uniqueid,file:p,folderName:c,outputType:e,password:u,locale:o.Locale},e=S(JSON.stringify(e));const n=await fetch(`${m}EditorApi/Download`,{method:"POST",headers:{"Content-Type":"application/octet-stream","Content-Encoding":"gzip"},body:e});if(!n.ok)throw new Error("Failed to send email, please try again");e=await n.json();const i=new FormData;i.append("appName",o.AppName),i.append("email",t),i.append("url",e.DownloadFileLink),i.append("title",`Aspose.Cells.Editor - ${e.FileName}`);const l=await fetch("/cells/editor/SendEmail",{method:"POST",crossDomain:!0,withCredentials:!0,body:i});e=await l.json();if(!l.ok)throw new Error("Failed to send email,please try again");return e.message}function S(e){e=pako.gzip(e);return new Blob([e])}function C(e,t,s){try{!function(){const e=document.createElement("div");e.id="aspose_mask_bg",e.style.position="absolute",e.style.top="0px",e.style.left="0px",e.style.width="100%",e.style.height="100%",e.style.backgroundColor="#777",e.style.opacity="0.6",e.style.zIndex="10001",document.body.appendChild(e);const t=document.createElement("div");t.style.position="absolute",t.style.top="33%",t.style.left="40%",t.style.backgroundColor="white",t.style.border="#336699 1px solid",t.style.textAlign="center",t.style.fontSize="medium",t.style.padding="1.5em 4em 1.5em 4em",t.innerText="Downloading, please wait...",e.appendChild(t)}();const i=r.datas;delete i.history,delete i.search,delete i.images,delete i.shapes;var o={p:{sheetname:r.sheet.data.name,actrow:r.sheet.data.selector.ri,actcol:r.sheet.data.selector.ci,datas:r.getUpdateDatas()},uid:uniqueid,file:e,folderName:c,outputType:t,password:u},a=S(JSON.stringify(o)),n=`${m}EditorApi/Download`;$.ajax({method:"POST",url:n,xhrFields:{withCredentials:!0},crossDomain:!0,header:{contentType:"application/octet-stream","Content-Encoding":"gzip"},data:a,processData:!1,success:e=>{if(k(),200===e.StatusCode)switch(s){case"GoogleDrive":i=e.DownloadFileLink,l=e.FileName,f.callback=async e=>{if(void 0!==e.error)throw e;w=e.access_token,fetch(i).then(e=>e.blob()).then(e=>{const t=new FormData;t.append("metadata",new Blob([JSON.stringify({name:l})],{type:"application/json"})),t.append("file",e),fetch("https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart",{method:"POST",headers:new Headers({Authorization:`Bearer ${w}`}),body:t}).then(e=>e.json(),e=>{alert("Failed to save to Google Drive")}).then(()=>{alert("Successfully saved to Google Drive")})})},null===w?f.requestAccessToken({prompt:"consent"}):f.requestAccessToken({prompt:""});break;case"Dropbox":o=e.DownloadFileLink,a=e.FileName,n={success:function(){alert("Successfully saved to Dropbox")},progress:function(){},cancel:function(){},error:function(){alert("Failed to save to Dropbox")}},Dropbox.save(o,a,n);break;case"Device":n=e.DownloadFileLink,t=e.FileName,fetch(n).then(e=>e.blob(),e=>{alert("Download failed, please try again")}).then(e=>function(e,t){const o=document.createElement("a");let a=e;"string"==typeof e?o.target="_blank":a=window.URL.createObjectURL(e),o.href=a,o.download=t,document.body.appendChild(o),o.click(),document.body.removeChild(o),"string"!=typeof e&&window.URL.revokeObjectURL(a)}(e,t));break;default:alert("Download failed, please try again")}else alert("Download failed, please try again");var t,o,a,n,i,l},error:()=>{k(),alert("Download failed, please try again")}})}catch(e){k(),alert("Download failed, please try again")}}function v(e){e=new RegExp(`(^|&)${e}=([^&]*)(&|$)`),e=window.location.search.substring(1).match(e);return null!=e?decodeURI(e[2]):""}function D(){window.parent&&window.parent.closeIframe?window.parent.closeIframe():window.location.href=t}function k(){const e=document.getElementById("aspose_mask_bg");null!=e&&e.parentNode.removeChild(e)}function E(){g=!0}function x(e){return null==e||""===e||"null"===e||"undefined"===e}x(c)||x(p)?D():($("#file_name").text(p),e=`${m}EditorApi/DetailStreamJsonWithUid`,$.ajax({method:"POST",url:e,xhrFields:{withCredentials:!0},crossDomain:!0,data:JSON.stringify({file:p,folder:c,password:x(u)?"":u,uid:a,locale:o.Locale}),contentType:"application/json",cache:!1,error:function(e){return void 0!==e&&void 0!==e.Status?alert(e.Status):void 0!==e.responseJSON&&void 0!==e.responseJSON.Status?alert(e.responseJSON.Status):alert("Error"),void D()},success:function(e){e.Error?(alert(e.Error),D()):($(".content-wrapper").css("background","none"),function(e){uniqueid=e.uniqueid,e.data.forEach(e=>{e.rows.len<50&&(e.rows.len=50)}),s=e.data;var t=`${m}EditorApi/ImageUrl`,a=`${m}EditorApi/UpdateCell`,n="zh-hant"===o.Locale?"cht":o.Locale;r=x_spreadsheet("#xs-div",{updateMode:"server",updateUrl:a,mode:"edit",folderName:c,fileName:p,local:n,showCheckSyntaxButton:d,checkSyntax:!1,showFormulaExplain:d}).loadData(s).updateCellError(e=>{alert(e)}),e.showtabs||r.bottombar.hide();var i=`${m}EditorApi/AddImage`,a=`${m}EditorApi/AddImageByUrl`,n=`${m}EditorApi/CopyImage`;r.setUniqueId(uniqueid),r.setImageInfo(t,i,a,n,l),r.setActiveSheetByName(e.actname).setActiveCell(e.actrow,e.actcol),$.fn.scrollEnd=function(t,o){$(this).scroll(function(){const e=$(this);e.data("scrollTimeout")&&clearTimeout(e.data("scrollTimeout")),e.data("scrollTimeout",setTimeout(t,o))})},r.setFileDownloadCallFunction(C),r.setFileName(p),r.setEmailSendCallFunction&&r.setEmailSendCallFunction(b);r.setOpenFileUrl&&r.setOpenFileUrl(h);e=`${m}EditorApi/Ole`;r.setOleDownloadInfo(e);e=`${m}EditorApi/CheckSyntax`;r.setSyntaxCheckUrl(e);e=`${m}EditorApi/FormulaExplain`;r.setFormulaExplainUrl(e)}(e))}}),$("#confirmClose").on("click",function(){$("#confirmCloseModal").modal({keyboard:!0})}),$("#confirmCloseModal").on("show.bs.modal",function(){$("#confirmCloseModal").css("display","flex")}),async function(){$.getScript(`${o.JsPath}/bootstrap.min.${o.JsVersionSuffix}`),$.getScript(`${o.JsPath}/jszip.min.${o.JsVersionSuffix}`),$.getScript(`${o.JsPath}/pako.min.${o.JsVersionSuffix}`),$.getScript("https://apis.google.com/js/api.js",function(){gapi.load("picker",E)}),$.getScript("https://accounts.google.com/gsi/client",function(){f=google.accounts.oauth2.initTokenClient({client_id:i,scope:n,callback:""}),y=!0})}().then())});